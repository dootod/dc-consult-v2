{% extends 'base.html.twig' %}

{% block title %}Se connecter{% endblock %}

{% block body %}

<div class="auth-page">

    {# ── Panneau gauche décoratif ── #}
    <div class="auth-panel auth-panel--deco" aria-hidden="true">
        <div class="auth-panel__bg"></div>
        <div class="auth-panel__content">

            <div class="auth-panel__logo-wrap">
                <img src="{{ asset('images/logo.png') }}" alt="DC Consult" class="auth-panel__logo">
            </div>

            <div class="auth-panel__tagline">
                <h2 class="auth-panel__title">Bienvenue sur<br>votre espace client</h2>
                <p class="auth-panel__sub">Accédez à vos documents et gérez votre compte en toute sécurité.</p>
            </div>

            <ul class="auth-panel__features">
                <li><i class="fa-solid fa-shield-halved"></i> Connexion sécurisée</li>
                <li><i class="fa-solid fa-folder-open"></i> Documents accessibles 24h/24</li>
                <li><i class="fa-solid fa-chart-line"></i> Activité de votre compte en temps réel</li>
            </ul>

        </div>
    </div>

    {# ── Panneau droit formulaire ── #}
    <div class="auth-panel auth-panel--form">
        <div class="auth-form-wrap">

            {# Logo mobile #}
            <div class="auth-form__logo-mobile">
                <img src="{{ asset('images/logo.png') }}" alt="DC Consult">
            </div>

            <div class="auth-form__header">
                <h1 class="auth-form__title">Connexion</h1>
                <p class="auth-form__sub">Entrez vos identifiants pour accéder à votre espace.</p>
            </div>

            {# Flash messages #}
            {% for label, messages in app.flashes(['success', 'warning', 'danger']) %}
                {% for message in messages %}
                    {% set alertClass =
                        label == 'success' ? 'dc-alert--success' :
                        (label == 'danger'  ? 'dc-alert--danger'  : 'dc-alert--warning')
                    %}
                    {% set iconClass =
                        label == 'success' ? 'fa-circle-check' : 'fa-triangle-exclamation'
                    %}
                    <div class="dc-alert {{ alertClass }}">
                        <i class="fa-solid {{ iconClass }}"></i>
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
            {% endfor %}

            {# Erreur d'authentification Symfony Security #}
            {% if error %}
                <div class="dc-alert dc-alert--danger">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                    <span>{{ error.messageKey|trans(error.messageData, 'security') }}</span>
                </div>
            {% endif %}

            <form method="post" class="auth-form" novalidate>

                <div class="auth-form__field">
                    <label for="username" class="dc-form-label">
                        <i class="fa-solid fa-at"></i> Adresse email
                    </label>
                    <input
                        type="email"
                        id="username"
                        name="_username"
                        class="dc-form-control auth-form__input"
                        value="{{ last_username }}"
                        autocomplete="email"
                        required
                        autofocus
                        placeholder="votre@email.com"
                    >
                </div>

                <div class="auth-form__field">
                    <label for="password" class="dc-form-label">
                        <i class="fa-solid fa-lock"></i> Mot de passe
                    </label>
                    <div class="auth-input-wrap">
                        <input
                            type="password"
                            id="password"
                            name="_password"
                            class="dc-form-control auth-form__input"
                            autocomplete="current-password"
                            required
                            placeholder="••••••••"
                        >
                        <button type="button" class="auth-toggle-pw" aria-label="Afficher le mot de passe" tabindex="-1">
                            <i class="fa-regular fa-eye"></i>
                        </button>
                    </div>
                </div>

                <input type="hidden" name="_csrf_token" data-controller="csrf-protection" value="{{ csrf_token('authenticate') }}">

                <button type="submit" class="dc-btn dc-btn--primary auth-form__submit">
                    <i class="fa-solid fa-arrow-right-to-bracket"></i>
                    Se connecter
                </button>

            </form>

            <p class="auth-form__switch">
                Pas encore de compte ?
                <a href="{{ path('app_inscription') }}" class="auth-form__switch-link">Créer un compte</a>
            </p>

        </div>
    </div>

</div>

{% endblock %}
